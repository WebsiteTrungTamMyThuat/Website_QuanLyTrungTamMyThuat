{% extends "layout/layout-user.html" %} {% block title %} Home {% endblock %} 
{%block content %} 
{% load static%}
<link rel="stylesheet" href="{% static "css/dangky-dangnhap.css" %}">
<div class="body">
    <div class="login-box">
        <div class="login-header">
            <header>Đăng nhập</header>
        </div>
        <form action="{% url 'dangnhap' %}" method="POST">
            {% csrf_token %}

            {% if messages %}
                <div class="error-messages">
                    {% for message in messages %}
                        <p class="error-text">{{ message }}</p>
                    {% endfor %}
                </div>
            {% endif %}


            <div class="input-box">
                <input type="email" class="input-field" placeholder="Email" autocomplete="off" required name="username" id="username"> 
            </div>
            <div class="input-box">
                <input type="password" class="input-field password" placeholder="Password" autocomplete="off" required name="pass_word" id="pass_word" >
            </div>
       
        <div class="forgot">
            <section>
                <input type="checkbox" id="check" onclick="togglePassword()">
                <label for="check">Hiện mật khẩu</label>
            </section>
            <section>
                <a href="{% url "quenmk" %}">Quên mật khẩu?</a>
            </section>
        </div>
        <div class="input-submit">
            <button class="submit-btn" id="submit"></button>
            <label for="submit">Đăng nhập</label>
        </div>
        <div class="sign-in-link">
            <p>Nếu bạn không có tài khoản? <a href="{% url "dangky" %}">Đăng ký</a></p>
        </div>
    </form>
    </div>

   
    

    
    <script>
        // Khi người dùng nhấn nút Đăng nhập
        const check = document.getElementById('submit');
        check.addEventListener('click', function(event) {
            // Ngừng hành động mặc định của form khi không cần thiết
            event.preventDefault();
    
            // Lấy dữ liệu từ form
            const username = document.getElementById('username').value;
            const password = document.getElementById('pass_word').value;
    
            // Kiểm tra nếu cả username và password đều không trống
            if (username && password) {
                // Gửi dữ liệu đăng nhập qua AJAX tới server
                fetch("{% url 'dangnhap' %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                        "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: `username=${username}&pass_word=${password}`
                })
                .then(response => response.json())  // Phản hồi JSON từ server
                .then(data => {
                    if (data.success) {
                        // Nếu đăng nhập thành công, lưu vào localStorage và chuyển hướng
                        localStorage.setItem('isLoggedIn', 'true');
                        localStorage.setItem('username', username); // Lưu tên người dùng vào localStorage


                        alert('Chào mừng, ' + username + '!');

                        window.location.href = "{% url 'user' %}";  // Chuyển hướng trang sau khi đăng nhập
                    } else {
                        // Nếu đăng nhập thất bại, hiển thị thông báo lỗi
                        alert(data.message);
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
            } else {
                alert("Vui lòng nhập đầy đủ thông tin.");
            }
        });
    
        function togglePassword() {
            const passwordFields = document.querySelectorAll('.password');
            passwordFields.forEach(field => {
                field.type = (field.type === 'password' ? 'text' : 'password');
            });
        }
    </script>


</div>
{%endblock%}


<script src="{% static "js/script.js" %}">